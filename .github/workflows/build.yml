name: Build Fabric mod (1.20.1)

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Unzip uploaded ZIP if exists
        if: ${{ contains( join(fromJSON('[]'), ''), '' ) }}
        run: |
          # se você subiu um zip no repositório root, tenta extrair
          for f in *.zip; do
            [ -f "$f" ] && unzip -o "$f" -d extracted && break || true
          done
          # move conteúdo extraído para root se existiu
          if [ -d extracted ]; then
            shopt -s dotglob
            mv extracted/* .
          fi

      - name: Set up Java 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'

      - name: Try to run Gradle wrapper or system Gradle
        run: |
          if [ -f "./gradlew" ]; then
            chmod +x ./gradlew
            ./gradlew clean build --no-daemon
          else
            # instala gradle por apt and tenta usar
            sudo apt update
            sudo apt install -y gradle
            gradle clean build --no-daemon
          fi

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: smart-baritone-jar
          path: |
            build/libs/*.jar
            */build/libs/*.jar
            
